$(document).ready(function(){$("[id^=email_delivery_]").tipsy({html:true});$("[id^=chain_link_]").tipsy({html:true});$("[id^=tree_link_]").tipsy({html:true});$("[id^=download_link_]").tipsy({html:true});$("[id^=show_child_certs_]").tipsy({html:true});$("[id^=active_]").tipsy({html:true});if(window.__pki_model__=="certificateauthority"||window.__pki_model__=="certificate"){if(typeof UpdateTime==="function"){UpdateTime();setInterval(UpdateTime,1E3)}if($("input[id=id_pkcs12_encoded]")){$("#id_pkcs12_passphrase").bind("change keyup focus",
{a:"#id_pkcs12_passphrase",b:"#id_pkcs12_passphrase_verify"},onPfChange);$("#id_pkcs12_passphrase_verify").bind("change keyup focus",{a:"#id_pkcs12_passphrase",b:"#id_pkcs12_passphrase_verify"},onPfChange)}if(window.__pki_add__!="True"){onActionChange();$("input[name=action]").change(onActionChange);$("form").submit(function(){!$("input[id=id_action_3]").attr("checked")&&window.__pki_model__=="CertificateAuthority"&&$("input[id=id_passphrase]").val("XXXXXXXXXXXXXXXXXXXXXXXXXX");$("#certificateauthority_form :input:not(:submit), #certificate_form :input:not(:submit)").each(function(a,
b){$(b).removeAttr("disabled")})})}else{$("input[id=id_action_1]").attr("disabled","disabled");$("input[id=id_action_2]").attr("disabled","disabled");$("input[id=id_action_3]").attr("disabled","disabled");$("label[for=id_passphrase_verify]").addClass($("label[for=id_passphrase]").attr("class"));onParentChange();onCnChange();$("#id_parent").change(onParentChange);$("#id_common_name").bind("change keyup",onCnChange);$("#id_passphrase").bind("change keyup focus",{a:"#id_passphrase",b:"#id_passphrase_verify"},
onPfChange);$("#id_passphrase_verify").bind("change keyup focus",{a:"#id_passphrase",b:"#id_passphrase_verify"},onPfChange)}}else if(window.__pki_model__=="x509extension"&&window.__pki_add__!="True"){$("#x509extension_form :input:not(:submit, :hidden)").each(function(a,b){$(b).attr("disabled","disabled");$(b).css("background-color","#F2F2F2")});$("form").submit(function(){$("#x509extension_form :input:not(:submit)").each(function(a,b){$(b).removeAttr("disabled")})})}});
function onActionChange(){$("input[id=id_action_0]").attr("disabled","disabled");$("input[id=id_action_0]").attr("checked")&&$("input[id=id_action_1]").attr("checked","checked");var a=[],b=$("#certificateauthority_form :input:not(:submit), #certificate_form :input:not(:submit)");a.id_description=1;a.id_action_1=1;a.id_action_2=1;a.id_action_3=1;if($("input[id=id_action_1]").attr("checked")){$("label[for=id_parent_passphrase]").removeClass("required");a.id_der_encoded=1;$("input[id=id_der_encoded]").parent().parent().css("background-color",
"#fffcaa");if(window.__pki_model__=="certificate"){a.id_pkcs12_encoded=1;a.id_pkcs12_passphrase=1;a.id_pkcs12_passphrase_verify=1;$("input[id=id_pkcs12_encoded]").parent().parent().css("background-color","#fffcaa")}}else if($("input[id=id_action_2]").attr("checked")){$("label[for=id_parent_passphrase]").addClass("required");a.id_parent_passphrase=1;$("input[id=id_der_encoded]").parent().parent().css("background-color","#ffffff");$("input[id=id_pkcs12_encoded]").parent().parent().css("background-color",
"#ffffff");window.__pki_model__=="certificate"&&$("input[id=id_pkcs12_encoded]").parent().parent().css("background-color","#ffffff")}else if($("input[id=id_action_3]").attr("checked")){$("input[id=id_passphrase]").val("");$("input[id=id_passphrase_verify]").val("");$("label[for=id_parent_passphrase]").addClass("required");a.id_country=1;a.id_state=1;a.id_locality=1;a.id_organization=1;a.id_OU=1;a.id_email=1;a.id_valid_days=1;a.id_passphrase=1;a.id_parent_passphrase=1;a.id_der_encoded=1;$("input[id=id_der_encoded]").parent().parent().css("background-color",
"#fffcaa");if(window.__pki_model__=="certificate"){a.id_purpose=1;a.id_subjaltname=1;a.id_pkcs12_encoded=1;a.id_pkcs12_passphrase=1;a.id_pkcs12_passphrase_verify=1;$("input[id=id_pkcs12_encoded]").parent().parent().css("background-color","#fffcaa")}}b.each(function(f,c){if(a[c.id]){$(c).removeAttr("disabled");$(c).css("background-color","#fffcaa")}else{$(c).attr("disabled","disabled");$(c).css("background-color","#F2F2F2")}})}
function onParentChange(){if($("#id_parent option:selected").val()!=""){$("#id_parent_passphrase").css("background-color","#fffcaa");$("#id_type option[value=SubCA]").length==0&&$("#id_type").prepend('<option value="SubCA" selected="selected">SubCA</option>');$("label[for=id_parent_passphrase]").addClass("required");$("#id_type option[value='RootCA']").remove()}else{$("#id_parent_passphrase").css("background-color","#FFFFFF");$("#id_type option[value=RootCA]").length==0&&$("#id_type").prepend('<option value="RootCA" selected="selected">self-signed (RootCA)</option>');
$("label[for=id_parent_passphrase]").removeClass("required");$("#id_type option[value='SubCA']").remove()}}
function onCnChange(){var a=$("#id_common_name").val(),b=strFilter(a);if(a!=""&&b==""){$("#id_name").css("background-color","#fffcaa");$("#id_name").val("");$("#no_valid_name").length==0&&$("#id_name").after('<p id="no_valid_name"><font color="red"><strong>CommonName must contain at least one valid charcter (a-Z0-9)</strong></font></p>')}else if(b!=""){$("#id_name").css("background-color","#d8fbd8");$("#id_name").css("color","#000000");$("#id_name").val(b);$("#no_valid_name").length>0&&$("#no_valid_name").remove()}else{$("#id_name").css("background-color",
"#FFFFFF");$("#id_name").val("")}return true}
function onPfChange(a){var b=$(a.data.a).val(),f=$(a.data.b).val(),c=$(a.data.a),d=$(a.data.b);a="pf_match_"+a.data.b.replace(/#/,"");var e="#"+a;if(b.length>0||f.length>0)if(b!=f){d.css("background-color","#f15959");c.css("background-color","#ffffff");$(e).length>0&&$(e).remove();d.after('<span style="margin-left: 10px;" id="'+a+'"><img src="'+window.__admin_media_prefix__+'img/admin/icon-no.gif" />&nbsp;Mismatch</span>')}else{c.css("background-color","#d8fbd8");d.css("background-color","#d8fbd8");
$(e).length>0&&$(e).remove();d.after('<span style="margin-left: 10px;" id="'+a+'"><img src="'+window.__admin_media_prefix__+'img/admin/icon-yes.gif" />&nbsp;Match</span>')}else{$(e).remove();c.css("background-color","#ffffff");d.css("background-color","#ffffff")}}function strFilter(a){x=a.replace(/^\*/,"asterisk");y=x.replace(/ /g,"_");return y.replace(/[^a-zA-Z0-9\-\_\.]/g,"")};
